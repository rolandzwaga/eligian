# Implementation Plan: Event Action Code Completion

**Branch**: `030-event-action-code` | **Date**: 2025-11-12 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/030-event-action-code/spec.md`

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Implement intelligent code completion for event actions in the Eligian DSL. When developers type `on event "` and trigger completion, the IDE will suggest all 43 available Eligius event names with descriptions. Upon selecting an event, a complete action skeleton is generated with camelCase action naming (`handleEventName`), typed parameters from event metadata, and cursor positioned for immediate implementation. Includes investigation of Typir integration for event action parameter type checking.

## Technical Context

**Language/Version**: TypeScript 5.x with Node.js ESM (NodeNext module resolution)
**Primary Dependencies**: Langium 3.x (LSP framework), VS Code Language Server Protocol, Typir (type system framework, optional integration for this feature)
**Storage**: N/A (in-memory completion data from event metadata)
**Testing**: Vitest with Langium test utilities, 80% coverage threshold
**Target Platform**: VS Code Extension (language server), Node.js 19+
**Project Type**: Langium-based DSL with VS Code extension
**Performance Goals**: Completion response <300ms, skeleton generation instant
**Constraints**: LSP snippet format for cursor positioning, event metadata from timeline-events.generated.ts (43 events)
**Scale/Scope**: Single completion provider, 43 event names, skeleton generation for parametric actions

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

Verify compliance with `.specify/memory/constitution.md`:

- [x] **Simplicity & Documentation**: Extends existing completion infrastructure (eligian-completion-provider.ts). Straightforward string manipulation for camelCase conversion and LSP snippet generation.
- [x] **Comprehensive Testing**: Test-first development with unit tests for name conversion, integration tests for completion/skeleton generation using Langium test utilities. Follows TESTING_GUIDE.md patterns (eventActionProgram helper, CSS registry setup).
- [x] **No Gold-Plating**: Solves documented user pain point (manual boilerplate writing for event actions). Feature 028 already implements event name completion; this extends it with skeleton generation per user request.
- [x] **Code Review**: Standard PR workflow applies. Feature branch 030-event-action-code already created.
- [x] **UX Consistency**: Follows existing completion patterns (getEventNameCompletions, getOperationCompletions). Uses LSP CompletionItem.insertTextFormat = InsertTextFormat.Snippet consistently with existing completions.
- [x] **Functional Programming**: Pure functions for name transformation (hyphen-to-camelCase). Event metadata lookup is read-only. No global state. No Effect-ts needed (completion is synchronous, no I/O).

**Principle XVIII (Research & Documentation)**: Will consult context7 for LSP snippet syntax and Typir integration investigation.
**Principle XXIV (Unified Example File)**: Will add event action skeleton examples to examples/demo.eligian.
**Principle XXV (Test System Documentation)**: Will consult TESTING_GUIDE.md when creating test tasks (eventActionProgram helper, error code validation).

*All checks pass. No complexity violations.*

## Project Structure

### Documentation (this feature)

```
specs/030-event-action-code/
├── spec.md              # Feature specification
├── plan.md              # This file (implementation plan)
├── research.md          # Phase 0: LSP snippet syntax, Typir integration investigation
├── data-model.md        # Phase 1: Completion item structure, skeleton template model
├── quickstart.md        # Phase 1: Quick reference for using event action completion
└── tasks.md             # Phase 2: Generated by /speckit.tasks command (NOT created by /speckit.plan)
```

### Source Code (repository root)

```
packages/language/src/
├── completion/
│   ├── events.ts                              # Event name completions (Feature 028 - EXISTING)
│   ├── event-action-skeleton.ts               # NEW: Skeleton generation logic
│   └── __tests__/
│       ├── event-name-completion.spec.ts      # EXISTING: Event name completion tests
│       └── event-action-skeleton.spec.ts      # NEW: Skeleton generation tests
│
├── completion/metadata/
│   └── timeline-events.generated.ts           # EXISTING: Event metadata (43 events)
│
├── eligian-completion-provider.ts             # MODIFIED: Wire skeleton generation
│
├── type-system-typir/                         # OPTIONAL: Typir integration (US3)
│   ├── types/
│   │   └── EventActionType.ts                 # NEW (if Typir used): Event action type
│   ├── inference/
│   │   └── event-action-inference.ts          # NEW (if Typir used): Parameter type inference
│   └── __tests__/
│       └── event-action-type.spec.ts          # NEW (if Typir used): Type system tests
│
└── __tests__/
    └── event-action-integration/              # NEW: End-to-end completion tests
        ├── event-name-completion.spec.ts      # Integration test: event name completion
        └── skeleton-generation.spec.ts        # Integration test: skeleton generation

examples/
└── demo.eligian                               # MODIFIED: Add event action skeleton examples
```

**Structure Decision**: Langium-based DSL project (monorepo with multiple packages). This feature extends the `packages/language/` completion infrastructure. Event metadata already exists in `timeline-events.generated.ts` (Feature 028). Skeleton generation logic is added as a new module `event-action-skeleton.ts`, invoked from the existing completion provider. Typir integration (US3) is optional and will be decided during Phase 0 research.

## Complexity Tracking

*No constitutional violations. This section is empty.*
